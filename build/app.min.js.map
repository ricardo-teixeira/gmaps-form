{"version":3,"sources":["../src/js/app.js"],"names":[],"mappings":"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","file":"app.min.js","sourcesContent":["(function (win, doc) {\r\n  \"use strict\"\r\n\r\n  var $form = doc.getElementById('mapsForm');\r\n  var $modal = $('#mapsModal');\r\n  var map, marker, autocomplete, geocoder;\r\n  var initialData = {\r\n    // street: 'Mário Carniceli',\r\n    // country: 'BR',\r\n    // state: 'SP',\r\n    // city: 'Campinas'\r\n  }\r\n\r\n  function Field (props) {\r\n    var defaults = {\r\n      value: '',\r\n      required: true\r\n    }\r\n    return Object.assign({}, defaults, props);\r\n  }\r\n\r\n  var FORM_FIELDS_SCHEMA = {\r\n    street: new Field(),\r\n    country: new Field(),\r\n    state: new Field(),\r\n    city: new Field(),\r\n    neighborhood: new Field({ required: false }),\r\n    cep: new Field(),\r\n    lat: new Field(),\r\n    lng: new Field()\r\n  }\r\n\r\n  var FORM_FIELDS_MAP = {\r\n    route: ['long_name', 'street'],\r\n    country: ['short_name', 'country'],\r\n    administrative_area_level_2: ['long_name', 'city'],\r\n    administrative_area_level_1: ['short_name', 'state'],\r\n    sublocality_level_1: ['long_name', 'neighborhood'],\r\n    postal_code: ['long_name', 'cep']\r\n  };\r\n  /****************************/\r\n\r\n  function fetchBasicFields () {\r\n    $.when(getCountries(), getStates(), getCities()).then(function () {\r\n      setTimeout(function () {\r\n        updateForm(initialData);\r\n      }, 1000);\r\n    });\r\n  }\r\n\r\n  function getCountries () {\r\n    $.ajax({\r\n      method: 'GET',\r\n      url: 'src/json/countries.json'\r\n    }).then(function (response) {\r\n      var $countriesSelect = $form.querySelector('[name=\"country\"]')\r\n      var $countryList = '<option value=\"\">Selecione</option>';\r\n      response.forEach(function (country) {\r\n        return $countryList += '<option value=\"' + country.iso + '\">' + country.name + '</option>';\r\n      })\r\n\r\n      $countriesSelect.innerHTML = $countryList;\r\n    })\r\n  }\r\n\r\n  function getStates () {\r\n    $.ajax({\r\n      method: 'GET',\r\n      url: 'src/json/states.json'\r\n    }).then(function (response) {\r\n      var $statesSelect = $form.querySelector('[name=\"state\"]')\r\n      var $stateList = '<option value=\"\">Selecione</option>';\r\n      response.forEach(function (state) {\r\n        return $stateList += '<option value=\"' + state.code + '\">' + state.name + '</option>';\r\n      })\r\n\r\n      $statesSelect.innerHTML = $stateList;\r\n    })\r\n  }\r\n\r\n  function getCities () {\r\n    $.ajax({\r\n      method: 'GET',\r\n      url: 'src/json/cities.json'\r\n    }).then(function (response) {\r\n      var $citiesSelect = $form.querySelector('[name=\"city\"]')\r\n      var $cityList = '<option value=\"\">Selecione</option>';\r\n      response.forEach(function (city) {\r\n        return $cityList += '<option value=\"' + city.name + '\">' + city.name + '</option>';\r\n      })\r\n\r\n      $citiesSelect.innerHTML = $cityList;\r\n    });\r\n  }\r\n  /****************************/\r\n\r\n  function updateForm (fields) {\r\n    if (fields) {\r\n      var address = Object.assign({}, FORM_FIELDS_SCHEMA, fields);\r\n\r\n      Object.keys(address).forEach(function (field) {\r\n        var element = $form.elements[field];\r\n        if (element) {\r\n          $form.elements[field].value = (fields[field] && fields[field] != 'Unnamed Road') ? fields[field] : '';\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function geocodePosition (pos) {\r\n    geocoder.geocode({\r\n      latLng: pos\r\n    }, function (responses) {\r\n      if (responses && responses.length > 0) {\r\n        var address = mapApiToFormFields(responses[0]);\r\n        address.lat = pos.lat;\r\n        address.lng = pos.lng;\r\n        updateForm(address);\r\n        resetMapPosition(pos, true);\r\n      }\r\n    });\r\n  }\r\n\r\n  function handleMarkerDrag (e) {\r\n    var latLng = {\r\n      lat: e.latLng.lat(),\r\n      lng: e.latLng.lng()\r\n    }\r\n    geocodePosition(latLng);\r\n  }\r\n\r\n  function cleanFormErrors () {\r\n    var $errorsText = $form.querySelectorAll('.text-danger');\r\n    var $errorsClass = $form.querySelectorAll('.is-invalid');\r\n\r\n    $errorsText.forEach((error) => {\r\n      error.remove();\r\n    })\r\n\r\n    $errorsClass.forEach((error) => {\r\n      error.classList.remove('is-invalid');\r\n    })\r\n  }\r\n\r\n  function resetMapPosition (pos, zoom) {\r\n    if (pos.lat && pos.lng) {\r\n      map.setCenter(pos);\r\n      marker.setPosition(pos);\r\n      if (zoom) {\r\n        map.setZoom(19);\r\n      }\r\n    }\r\n  }\r\n\r\n  function getFormValues () {\r\n    var values = {};\r\n    Object.keys(FORM_FIELDS_SCHEMA).forEach(function (key) {\r\n      var field = $form.elements[key];\r\n      if (field) {\r\n        values[key] = $form.elements[key].value;\r\n      }\r\n    });\r\n\r\n    return values;\r\n  }\r\n\r\n  function validateForm () {\r\n    cleanFormErrors();\r\n\r\n    var formValues = getFormValues();\r\n    var isValid = Object.keys(formValues).every(function (key) {\r\n      return !!formValues[key] || !FORM_FIELDS_SCHEMA[key].required;\r\n    });\r\n\r\n    return $.Deferred(function () {\r\n      var self = this;\r\n\r\n      if (!isValid) {\r\n        Object.keys(formValues).forEach(function (key) {\r\n          var $field = $form.elements[key];\r\n\r\n          if (!$field.value && $field.type != 'hidden' && FORM_FIELDS_SCHEMA[key].required) {\r\n            $field.classList.add('is-invalid');\r\n            $field.parentNode.insertAdjacentHTML('afterend', '<small class=\"text-danger mt-2\">Obrigatório</small>');\r\n          }\r\n\r\n          return !!formValues[key];\r\n        });\r\n\r\n        return self.resolve(false);\r\n      }\r\n\r\n      return validateAddressAsync(formValues).then(function () {\r\n        return self.resolve(isValid);\r\n      }).fail(function () {\r\n        return self.reject(false);\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  function validateAddressAsync (address) {\r\n    return $.Deferred(function () {\r\n      var self = this;\r\n      var latLng = {\r\n        lat: parseFloat(address.lat),\r\n        lng: parseFloat(address.lng)\r\n      };\r\n\r\n      geocoder.geocode({ 'location': latLng }, function (results, status) {\r\n        if (status == google.maps.GeocoderStatus.OK) {\r\n          var mapsAddress = mapApiToFormFields(results[0]);\r\n\r\n          if (mapsAddress.street && mapsAddress.street != address.street) {\r\n            $form.insertAdjacentHTML('afterend', '<small class=\"text-danger mt-2\">Logradouro incorreto</small>')\r\n          }\r\n\r\n          if (mapsAddress.neighborhood && mapsAddress.neighborhood != address.neighborhood) {\r\n            $form.insertAdjacentHTML('afterend', '<div class=\"is-invalid\"><small class=\"text-danger mt-2\">Bairro incorreto</small></div>')\r\n          }\r\n\r\n          if (mapsAddress.cep && mapsAddress.cep != address.cep) {\r\n            $form.insertAdjacentHTML('afterend', '<div class=\"is-invalid\"><small class=\"text-danger mt-2\">Bairro incorreto</small></div>')\r\n          }\r\n\r\n          self.resolve();\r\n        } else {\r\n          self.reject();\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  function handleSubmit (e, callback) {\r\n    e.preventDefault();\r\n    validateForm().then(function (valid) {\r\n      if (valid) {\r\n        var values = getFormValues();\r\n        console.log('formFields', values);\r\n\r\n        if (callback) {\r\n          callback(values);\r\n        }\r\n\r\n        $modal.modal('hide');\r\n        return\r\n      }\r\n    });\r\n  }\r\n\r\n  function handleAutocomplete () {\r\n    cleanFormErrors();\r\n    var place = autocomplete.getPlace();\r\n    if (Object.keys(place).length > 1) {\r\n      var address = mapApiToFormFields(place);\r\n      updateForm(address);\r\n      resetMapPosition({ lat: address.lat, lng: address.lng }, true);\r\n    }\r\n  }\r\n\r\n  function findLocation (value) {\r\n    cleanFormErrors();\r\n    geocoder.geocode({ 'address': value }, function (results, status) {\r\n      if (status == google.maps.GeocoderStatus.OK) {\r\n        var address = mapApiToFormFields(results[0]);\r\n        var location = results[0].geometry.location;\r\n        resetMapPosition({ lat: location.lat(), lng: location.lng() })\r\n        updateForm(address);\r\n      } else {\r\n        console.error('Nenhum resultado encontrado');\r\n        $form.insertAdjacentHTML('beforeend', '<div class=\"is-invalid\"><small class=\"text-danger mt-2\">Endereço não encontrado</small></div>');\r\n      }\r\n    });\r\n  }\r\n\r\n  function mapApiToFormFields (place) {\r\n    var address = {};\r\n    address.lat = place.geometry.location.lat();\r\n    address.lng = place.geometry.location.lng();\r\n\r\n    place.address_components.forEach(function (component) {\r\n      var formField;\r\n\r\n      component.types.forEach(function (type) {\r\n        if (FORM_FIELDS_MAP[type]) {\r\n          formField = FORM_FIELDS_MAP[type];\r\n        }\r\n      });\r\n\r\n      if (formField) {\r\n        var value = component[formField[0]];\r\n        address[formField[1]] = value;\r\n      }\r\n    });\r\n\r\n    return address;\r\n  }\r\n\r\n  function setLoading (show) {\r\n    var $loading = document.getElementById('mapsLoading');\r\n    if ($loading) {\r\n      if (!show) {\r\n        $loading.style.display = 'none';\r\n      } else {\r\n        $loading.style.display = 'block';\r\n      }\r\n    }\r\n  }\r\n\r\n  function initMap (formData, callback) {\r\n    if (formData) {\r\n      initialData = formData;\r\n    }\r\n\r\n    fetchBasicFields()\r\n    // var latLng = {\r\n    //   lat: initialData.lat,\r\n    //   lng: initialData.lng\r\n    // };\r\n\r\n    geocoder = new google.maps.Geocoder();\r\n    map = new google.maps.Map(doc.getElementById('map'), {\r\n      // center: latLng,\r\n      zoom: 12,\r\n      mapTypeControl: true,\r\n      mapTypeControlOptions: {\r\n        position: google.maps.ControlPosition.TOP_CENTER\r\n      },\r\n      fullscreenControl: false\r\n    });\r\n\r\n    marker = new google.maps.Marker({\r\n      // position: latLng,\r\n      map: map,\r\n      draggable: true\r\n    });\r\n\r\n    google.maps.event.addListener(marker, 'dragend', handleMarkerDrag);\r\n    google.maps.event.addListener(map, 'tilesloaded', setLoading);\r\n\r\n    autocomplete = new google.maps.places.Autocomplete((document.getElementById('autocomplete')), { types: ['geocode'] });\r\n    autocomplete.addListener('place_changed', handleAutocomplete);\r\n\r\n    $form.addEventListener('submit', function (e) {\r\n      handleSubmit(e, callback);\r\n    });\r\n\r\n    $form.addEventListener('change', function (e) {\r\n      switch (e.target.name) {\r\n        case 'cep':\r\n          findLocation(e.target.value);\r\n        default:\r\n          return false;\r\n      }\r\n    });\r\n\r\n    $modal.on(\"shown.bs.modal\", function () {\r\n      google.maps.event.trigger(map, \"resize\");\r\n      var address = [];\r\n\r\n      Object.keys(initialData).forEach(function (key) {\r\n        address.push(initialData[key]);\r\n      });\r\n\r\n      geocoder.geocode({ 'address': address.join(', ') }, function (results, status) {\r\n        if (status == google.maps.GeocoderStatus.OK) {\r\n          var location = results[0].geometry.location;\r\n          resetMapPosition({ lat: location.lat(), lng: location.lng() })\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  win.mapsAddressFinder = initMap;\r\n\r\n  // doc.addEventListener('DOMContentLoaded', initMap)\r\n})(window, document)"]}